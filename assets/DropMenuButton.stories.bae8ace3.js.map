{"version":3,"file":"DropMenuButton.stories.bae8ace3.js","sources":["../../src/components/DropMenuButton/DropMenuButton.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react'\nimport styled, { css } from 'styled-components'\n\nimport Button from '../Button/Button'\n\ntype DropdownStyledProps = {\n  $maxHeight: number\n  $fromTop: boolean\n}\n\nexport type DropMenuButtonProps = {\n  label: string | React.ReactElement\n  id: string\n}\n\nconst DropMenuButtonWrapper = styled.div<DropdownStyledProps>`\n  position: relative;\n  [role='menu'] {\n    display: none;\n    position: absolute;\n    max-height: ${({ $maxHeight }) => `${$maxHeight}px`};\n    flex-direction: column;\n    left: 0;\n    overflow: auto;\n    top: calc(100% + 1px);\n    bottom: auto;\n    /* transform-origin: top left; */\n    left: 0;\n    background-color: #333;\n    padding: 0;\n    margin: 0;\n    width: 200px;\n    /* margin: 1rem 0 0 0; */\n    /* &:after {\n      position: absolute;\n      left: 1rem;\n      bottom: 100%;\n      content: '';\n      border-bottom: 8px solid #333;\n      border-left: 8px solid transparent;\n      border-right: 8px solid transparent;\n    } */\n    button {\n      color: #fff;\n      border-color: rgba(255, 255, 255, 0.2);\n      border-width: 0 0 1px 0;\n      background-color: transparent;\n      &:hover {\n        background-color: purple;\n      }\n    }\n    ${({ $fromTop }) =>\n      !$fromTop &&\n      css`\n        top: auto;\n        bottom: calc(100% + 1px);\n        /* margin: 0 0 1rem 0; */\n      `};\n  }\n  [aria-expanded='true'] + [role='menu'] {\n    display: flex;\n  }\n  svg {\n    margin: 0;\n  }\n`\n\nconst MAX_HEIGHT = 300\n\nexport const DropMenuButton: React.FunctionComponent<\n  DropMenuButtonProps & React.HTMLAttributes<HTMLButtonElement>\n> = ({ label, id, children, ...rest }) => {\n  const [expanded, setExpanded] = useState(false)\n  const [fromTop, setFromTop] = useState<boolean>(true)\n  const [dropMaxHeight, setDropMaxHeight] = useState<number>(MAX_HEIGHT)\n\n  const dropMenuRef = useRef<HTMLUListElement>(null)\n  const buttonRef = useRef<HTMLButtonElement>(null)\n\n  const handleClickOutside = (e: any) => {\n    if (dropMenuRef.current && !dropMenuRef.current.contains(e.target)) {\n      setExpanded(false)\n    }\n  }\n\n  const getElementFromTop = useCallback((): void => {\n    if (dropMenuRef.current && buttonRef.current) {\n      const dropRect = dropMenuRef.current.getBoundingClientRect()\n      const buttonRect = buttonRef.current.getBoundingClientRect()\n      const buttonFromTop = buttonRect.top + buttonRect.height\n      const { clientHeight } = document.documentElement\n      const downwards = dropRect.height + buttonFromTop < clientHeight\n      setFromTop(downwards)\n      //   const inUpperHalf = dropRect.top < clientHeight / 2 - dropRect.height / 2\n      let maxHeight = MAX_HEIGHT\n      //   setFromTop(inUpperHalf)\n      if (buttonRect.top > 0 && buttonFromTop < clientHeight) {\n        // const margin = 16\n        const setHeight = downwards\n          ? clientHeight - (buttonFromTop + dropRect.height)\n          : buttonFromTop\n        maxHeight = setHeight > maxHeight ? maxHeight : setHeight // - margin\n      }\n      setDropMaxHeight(maxHeight)\n    }\n  }, [])\n\n  useEffect(() => {\n    if (expanded) {\n      getElementFromTop()\n      window.addEventListener('scroll', getElementFromTop)\n      document.addEventListener('mousedown', handleClickOutside)\n    }\n    return () => {\n      window.removeEventListener('scroll', getElementFromTop)\n      document.removeEventListener('mousedown', handleClickOutside)\n    }\n  }, [expanded])\n\n  return (\n    <DropMenuButtonWrapper $maxHeight={dropMaxHeight} $fromTop={fromTop}>\n      <Button\n        type=\"button\"\n        aria-haspopup=\"true\"\n        aria-expanded={expanded}\n        aria-controls={id}\n        onClick={() => setExpanded(!expanded)}\n        ref={buttonRef}\n        {...rest}\n      >\n        {label}\n      </Button>\n      <ul role=\"menu\" id={id} aria-label={typeof label === 'string' ? label : id} ref={dropMenuRef}>\n        {children}\n      </ul>\n    </DropMenuButtonWrapper>\n  )\n}\n"],"names":["DropMenuButtonWrapper","styled","div","$maxHeight","$fromTop","css","MAX_HEIGHT","DropMenuButton","label","id","children","expanded","setExpanded","useState","fromTop","setFromTop","dropMaxHeight","setDropMaxHeight","dropMenuRef","useRef","buttonRef","handleClickOutside","e","getElementFromTop","useCallback","dropRect","buttonRect","buttonFromTop","clientHeight","downwards","maxHeight","setHeight","useEffect","window","document","_jsxs","rest"],"mappings":"mNAeA,MAAAA,EAAAC,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAqCC,CAAAA,CAKlB,WAAAC,CAAa,IAAA,GAAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAASA,CAAAA,CA+BlC,SAAAC,CAAW,IAAA,CAAAA,GAAAC;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA;AAAAA,EAgBlBC,EAAA,IAEOC,EAAA,CAAA,CAEF,MAAAC,EAAEA,GAAAA,EAAOC,SAAAA,KAAIC,CAAkB,IAAA,CAClC,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,QAAA,SAAA,EAAA,EACA,CAAAC,EAAAC,CAAA,EAAAF,EAAA,QAAA,SAAA,EAAA,EACA,CAAAG,EAAAC,CAAA,EAAAJ,EAAA,QAAA,SAAAP,CAAA,EAEAY,EAAAC,iBAAA,IAAA,EACAC,EAAAD,iBAAA,IAAA,EAEAE,EAAAC,GAAA,CACEJ,EAAA,SAAA,CAAAA,EAAA,QAAA,SAAAI,EAAA,MAAA,GACEV,EAAAA,EAAAA,CACF,EAGFW,EAAAC,EAAAA,QAAAA,YAAA,IAAA,CACE,GAAAN,EAAA,SAAAE,EAAA,QAAA,CACE,MAAAK,EAAAP,EAAA,QAAA,sBAAA,EACAQ,EAAAN,EAAA,QAAA,sBAAA,EACAO,EAAAD,EAAA,IAAAA,EAAA,OACA,CAAM,aAAAE,CAAEA,EAAAA,SAAAA,gBACRC,EAAAJ,EAAA,OAAAE,EAAAC,EACAb,EAAAA,CAAAA,EAEA,IAAAe,EAAAxB,EAEA,GAAAoB,EAAA,IAAA,GAAAC,EAAAC,EAAA,CAEE,MAAAG,EAAAF,EAAAD,GAAAD,EAAAF,EAAA,QAAAE,EAGAG,EAAAA,EAAAA,EAAAA,EAAAA,CAAgDC,CAElDd,EAAAA,CAAAA,CAA0B,CAC5B,EAAA,CAAA,CAAA,EAGFe,OAAAA,EAAAA,QAAAA,UAAAA,KACErB,IACEY,IACAU,OAAAA,iBAAAA,SAAAA,CAAAA,EACAC,SAAAA,iBAAAA,YAAAA,CAAAA,GAEF,IAAA,CACED,OAAAA,oBAAAA,SAAAA,CAAAA,EACAC,SAAAA,oBAAAA,YAAAA,CAAAA,CAA4D,GAC9D,CAAAvB,CAAA,CAAA,EAGFwB,EAAAnC,EAAA,CACwB,WAAAgB,EAAaA,SAAAA,EAAyBF,SAAAA,CAAAA,EAAAA,EAAAA,CACnD,KAAA,SACA,gBAAA,OACS,gBAAAH,EACCA,gBAAAA,EACAF,QAAAA,IAAAA,EAAAA,CAAAA,CAAAA,EACqB,IAAAW,EAC/BA,GAAAA,EACDgB,SAAAA,CAEH5B,CAAAA,EAAAA,EAAAA,KAAAA,CAEH,KAAA,OAAS,GAAAC,EAAOA,aAAAA,OAAAA,GAAAA,SAAAA,EAAAA,EAAwDA,IAAAA,EAASS,SAAAA,CAAYR,CAAAA,CAAAA,CAExF,CAAA,CAGX;;;;;;;;;;;"}